<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Critter Contraption Control</title>
	<meta name="description" content="Critter Contraption Control">
	<meta name="author" content="Brandon Yee">

	<!-- Load CSS frameworks from jsDelivr CDN. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/g/normalize@3.0.3,animatecss@3.5.1,skeleton@2.0.4">
	<link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel="stylesheet" type="text/css">
	<script src="https://cdn.jsdelivr.net/g/modernizr@2.8.3,respond@1.4.2"></script>
	<script src="https://use.fontawesome.com/52a6d6bd6a.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<!-- Load JS libraries from jsDelivr CDN. -->
	<script src="https://cdn.jsdelivr.net/g/jquery@2.2.3,jquery.color-animation@1.6.0,lodash@4.12.0,html5shiv@3.7.3(html5shiv.min.js+html5shiv-printshiv.min.js)"></script>

	<!-- To prevent Node from serving static files, just put the CSS in the head. -->
	<style>
		/* Font Awesome Skeleton Icons - DO NOT TOUCH */
		.button-icon{width:38px;padding:0}.button-icon .fa{width:38px;line-height:38px;font-size:1.4rem;vertical-align:top}td .button-icon{width:30px;height:30px;margin-bottom:0}td .button-icon .fa{width:28px;line-height:28px;font-size:1.3rem}

		/* Custom CSS */
		div.six.columns {
			text-align: center;
		}

		div.scheduleRow {
			border: 2px solid black;
			border-radius: 25px;
			padding: 10px;
		}

		th {
			text-align: center;
		}

		.margined {
			margin-right: 5px;
		}

		/* From Skeleton.css */
		.button.button-secondary,
		button.button-secondary,
		input[type="submit"].button-secondary,
		input[type="reset"].button-secondary,
		input[type="button"].button-secondary {
			color: #FFF;
			background-color: #f03333;
			border-color: #f03333; }
		.button.button-secondary:hover,
		button.button-secondary:hover,
		input[type="submit"].button-secondary:hover,
		input[type="reset"].button-secondary:hover,
		input[type="button"].button-secondary:hover,
		.button.button-secondary:focus,
		button.button-secondary:focus,
		input[type="submit"].button-secondary:focus,
		input[type="reset"].button-secondary:focus,
		input[type="button"].button-secondary:focus {
			color: #FFF;
			background-color: #db1e1e;
			border-color: #db1e1e; }
	</style>
</head>
<body>
	<div class="container">
		<!-- div.row>div.twelve.columns>h1{Critter Contraption}+h2{By Brandon Yee}+button#feed.button{Feed!}+button#showModelPics.button{Model Pictures}+p{Status: }>span#feedingStatus{Idle}^^^div#mainScheduleRow.row>div.six.columns>table#scheduleList>tr>th>{Critter will be fed on:}^th>{On/Off}^th>i.fa.fa-trash-o^^^^div.six.columns>button#newTimer.button{Create New Scheduled Time}+div#timerSettings>h3{Scheduled Time Settings}+{Feed every }+select#daySelect>option[value=Sunday]{Sunday}+option[value=Monday]{Monday}+option[value=Tuesday]{Tuesday}+option[value=Wednesday]{Wednesday}+option[value=Thursday]{Thursday}+option[value=Friday]{Friday}+option[value=Saturday]{Saturday}+option[value=ed]{Every day}+option[value=eod]{Every other day}^{ at }+select#hourSelect>option[value=$]{$}*12^{:}+select#minutesSelect>option[value=$$@0]{$$@0}*60^{ }+select#ampmSelect>option[value=am]{am}+option[value=pm]{pm}^button#timerSet.button{Create Timer}^^^div#modelPicRow.row>div.twelve.columns>p{Click on the picture or use arrow keys to navigate through the pictures.}+img#modelPic.u-full-width -->
		<div class="row">
			<div class="twelve columns">
				<h1>Critter Contraption</h1>
				<h2>By Brandon Yee</h2>
				<button id="feed" class="button">Feed!</button>
				<button id="showModelPics" class="button">Model Pictures</button>
				<p>Status: <span id="feedingStatus">Idle</span></p>
			</div>
		</div>
		<div id="mainScheduleRow" class="row">
			<div class="six columns">
				<table id="scheduleList">
					<tr>
						<th>Critter will be fed on:</th>
						<th>On/Off</th>
						<th><i class="fa fa-trash-o"></i></th>
					</tr>
				</table>
			</div>
			<div class="six columns">
				<button id="newTimer" class="button">Create New Scheduled Time</button>
				<div id="timerSettings">
					<h3>Scheduled Time Settings</h3>Feed every 
					<select name="" id="daySelect">
						<option value="Sunday">Sunday</option>
						<option value="Monday">Monday</option>
						<option value="Tuesday">Tuesday</option>
						<option value="Wednesday">Wednesday</option>
						<option value="Thursday">Thursday</option>
						<option value="Friday">Friday</option>
						<option value="Saturday">Saturday</option>
						<option value="ed">Every day</option>
						<option value="eod">Every other day</option></select> at 
					<select name="" id="hourSelect">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option></select>:
					<select name="" id="minutesSelect">
						<option value="00">00</option>
						<option value="01">01</option>
						<option value="02">02</option>
						<option value="03">03</option>
						<option value="04">04</option>
						<option value="05">05</option>
						<option value="06">06</option>
						<option value="07">07</option>
						<option value="08">08</option>
						<option value="09">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
						<option value="31">31</option>
						<option value="32">32</option>
						<option value="33">33</option>
						<option value="34">34</option>
						<option value="35">35</option>
						<option value="36">36</option>
						<option value="37">37</option>
						<option value="38">38</option>
						<option value="39">39</option>
						<option value="40">40</option>
						<option value="41">41</option>
						<option value="42">42</option>
						<option value="43">43</option>
						<option value="44">44</option>
						<option value="45">45</option>
						<option value="46">46</option>
						<option value="47">47</option>
						<option value="48">48</option>
						<option value="49">49</option>
						<option value="50">50</option>
						<option value="51">51</option>
						<option value="52">52</option>
						<option value="53">53</option>
						<option value="54">54</option>
						<option value="55">55</option>
						<option value="56">56</option>
						<option value="57">57</option>
						<option value="58">58</option>
						<option value="59">59</option></select> 
					<select name="" id="ampmSelect">
						<option value="am">am</option>
						<option value="pm">pm</option></select>
					<button id="timerSet" class="button">Create Timer</button>
				</div>
			</div>
		</div>
		<div id="modelPicRow" class="row">
			<div class="twelve columns">
				<p>Click on the picture or use arrow keys to navigate through the pictures.</p>
				<img src="" alt="" id="modelPic" class="u-full-width">
			</div>
		</div>
	</div> <!-- CONTAINER ENDS HERE -->
	<!-- JS goes here, don"t forget $(document).ready() -->
	<script>
	$(function documentReadyInner () {
		// Setup Variables
		var socket = io.connect(),
			fadeSpeed = 200,
			curPic = 0,
			maxPics = 5,
			modelPics = [
				"http://s32.postimg.org/ep94le9sl/Designs.jpg",
				"http://s32.postimg.org/rxmr2xset/Designs_2.jpg",
				"http://s32.postimg.org/rip9f5amt/Designs_3.jpg",
				"http://s32.postimg.org/7lsixo6j9/Designs_4.jpg",
				"http://s32.postimg.org/e4z5ftmvp/Designs_5.jpg"
			],
			$status = $("#feedingStatus"),
			$mainScheduleRow = $("#mainScheduleRow"),
			$scheduleList = $("#scheduleList"),
			$newTimer = $("#newTimer"),
			$timerSettings = $("#timerSettings"),
			$timerSet = $("#timerSet"),
			$modelPicRow = $("#modelPicRow"),
			$modelPic = $("#modelPic"),
			i;

		// Setup Animations
		$timerSettings.hide();
		$modelPicRow.hide();
		$modelPic.attr("src", modelPics[curPic]);

		// Feed Button
		$("#feed").click(function feedButtonDomClicked () {
			socket.emit("feed", {});
		});

		// Create Timer
		$newTimer.click(function newTimerDomClicked () {
			// $(this).prop("disabled", true);
			if ($timerSettings.is(":visible")) {
				$timerSettings.fadeOut(fadeSpeed);
			} else {
				$timerSettings.fadeIn(fadeSpeed);
			}
		});
		$timerSet.click(function timerSetDomClicked () {
			// Store values of select>options.
			var timerSettings = {};
			var $selects = $timerSettings.find("select");
			for (i = 0; i < $selects.length; i++) {
				timerSettings[$selects.eq(i).attr("id")] = $selects.eq(i).val();
			}

			// Connect with server-side.
			socket.emit("serverNewTimer", timerSettings);

			// Animations.
			$timerSettings.fadeOut(fadeSpeed);
			// $newTimer.prop("disabled", false);
		});

		// Get Status
		socket.on("servoStarted", function servoStartedInner () {
			$status.text("Feeding!");
		});
		socket.on("servoFinished", function servoFinishedInner () {
			$status.text("Idle");
		});

		// Add to Schedule
		function addToSchedule (ts, whereFrom) {
			console.log("Adding the following the schedule list:"); console.log(ts);
			if (ts.daySelect === "ed") ts.daySelect = "Every day";
			if (ts.daySelect === "eod") ts.daySelect = "Every other day";

			// New Row in Table
			$scheduleList.append(
				"<tr id='scheduleRow" + ts.id + "' class='scheduleRow'>" +
				"<td>" + ts.daySelect + ", " + ts.hourSelect + ":" + ts.minutesSelect + " " + ts.ampmSelect + "</td>" +
				"<td><button id='toggleTimer" + ts.id + "' class='button button-primary margined'></button></td>" +
				"<td><button id='deleteTimer" + ts.id + "' class='button button-secondary'>" +
				"<i class='fa fa-trash-o fa-lg'></i></button></td></tr>"
			);

			// Setup Toggle Timer
			if (ts.status === "on") {
				$("#toggleTimer" + ts.id).val("on");
				$("#toggleTimer" + ts.id).addClass("button-primary margined");
				$("#toggleTimer" + ts.id).text("ON");
			} else {
				$("#toggleTimer" + ts.id).val("off");
				$("#toggleTimer" + ts.id).removeClass("button-primary margined");
				$("#toggleTimer" + ts.id).text("OFF");
			}

			// Attach ON/OFF Click Handler
			$("#toggleTimer" + ts.id).click(function toggleTimerAttachEvent () {
				if ($(this).val() === "on") {
					socket.emit("toggleTimer", {
						id: ts.id,
						newVal: "off"
					});
					$(this).val("off");
					$(this).removeClass("button-primary margined");
					$(this).text("OFF");
				} else {
					socket.emit("toggleTimer", {
						id: ts.id,
						newVal: "on"
					});
					$(this).val("on");
					$(this).addClass("button-primary margined");
					$(this).text("ON");
				}
			});

			// Attach Delete Handler
			$("#deleteTimer" + ts.id).click(function deleteTimerAttachEvent () {
				socket.emit("deleteTimer", {id: ts.id});
			});
		}

		// Create New Timer
		socket.on("newSchedule", function newScheduleInner (ts) { addToSchedule(ts, "newSchedule"); });

		// Get Old Timers
		socket.emit("readyForOldSchedule");
		socket.on("oldSchedule", function oldScheduleInner (schedule) {
			console.log("Old Timers:"); console.log(schedule);
			if (Object.keys(schedule).length > 0) {
				for (var key in schedule) {
					if (schedule.hasOwnProperty(key)) {
						addToSchedule(schedule[key], "oldSchedule");
					}
				}
			}
		});

		// Delete From Schedule
		socket.on("deleteFromSchedule", function deleteFromScheduleInner (deleteSettings) {
			var id = deleteSettings.id;
			$("#scheduleRow" + id).fadeOut(fadeSpeed, function deleteTimerClicked () {
				$("#scheduleRow" + id).remove();
			});
		});

		// Toggle Model Pictures
		$("#showModelPics").click(function showModelPicsInner () {
			if ($mainScheduleRow.is(":visible")) {
				$mainScheduleRow.hide();
				$modelPicRow.fadeIn(fadeSpeed);
			} else {
				$modelPicRow.hide();
				$mainScheduleRow.fadeIn(fadeSpeed);
			}
		});

		// Change Model Picture.
		$modelPic.click(function modelPicClickedInner () {
			if (curPic === (maxPics - 1)) {
				curPic = 0;
			} else {
				curPic += 1;
			}
			$modelPic.attr("src", modelPics[curPic]);
		});
		$(document).keyup(function keyPressDetectedInner (e) {
			e.preventDefault();
			if (e.which === 39 || e.which === 40) {
				if (curPic === (maxPics - 1)) {
					curPic = 0;
				} else {
					curPic += 1;
				}
			}
			if (e.which === 37 || e.which === 38) {
				if (curPic === 0) {
					curPic = (maxPics - 1);
				} else {
					curPic -= 1;
				}
			}
			$modelPic.attr("src", modelPics[curPic]);
		});
		
	});
	</script>
</body>
</html>